pipeline {
    agent { label 'usdatazdvhyb1-remotesellproxy' }
    parameters {
        string(name:'DeploymentName', description:'Please enter the Deployment File ..')
    }
    stages {
        stage('Download Deployment File') {
            steps {
                sh '''
                cd /home/remotesellproxy/deploys
                echo "${DeploymentName}"
                rm /home/remotesellproxy/deploys/${DeploymentName}
                wget --user-agent="Mozilla" https://lpl.sharepoint.com/sites/Remotereservationandpayment-RemoteAppDEV/Documents%20partages/Remote%20App%20DEV/${DeploymentName}
                '''
            }
        }
		  stage('Copy Deployment File') {
            steps {
                sh '''
				    echo "Copy the App File "
                    cp -rp /home/remotesellproxy/deploys/${DeploymentName} /home/remotesellproxy/proxyapp/${DeploymentName}
				'''
            }
          }
            stage('Shutdown Node Process') {
            steps {
                 script {
                           def now = new Date()
                        println now.format("yyMMdd.HHmm", TimeZone.getTimeZone('UTC'))
                         }
                sh '''	
                #ps aux|grep node |grep server.js |awk {'print $2'}|xargs kill -9
                echo "Killing the Process"
				'''
              }
            }
            stage('Backup Previous version') {
            steps {
                sh '''
				    #cp -rp /home/remotesellproxy/proxapp/package /home/remotesellproxy/proxyapp/package_$date
                    echo "Making a Backup "
				'''
            }
        }
            stage('unzip the Deployment file') {
            steps {
                sh '''
				    #unzip 
                    echo "Unzip file "
				'''
            }
            }
            stage('Start the Node Process...') {
            steps {
                sh '''
				    #nohup /home/remotesellproxy/proxapp/package/server.js -e test &
                    echo "Starting node Process "
				'''
            }
        }

}
}
